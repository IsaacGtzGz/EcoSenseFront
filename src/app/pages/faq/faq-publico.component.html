<div class="faq-publico">
  <h2>Preguntas Frecuentes y Comentarios</h2>
  <ng-container *ngIf="isLoggedIn(); else noAuth">
    <form (submit)="enviarPregunta(); $event.preventDefault()">
      <textarea [(ngModel)]="nuevaPregunta" name="pregunta" placeholder="Escribe tu pregunta o comentario..."
        rows="3"></textarea>
      <label>
        Valoración:
        <select [(ngModel)]="estrellas" name="estrellas">
          <option *ngFor="let star of [1,2,3,4,5]" [value]="star">{{star}} ★</option>
        </select>
      </label>
      <button type="submit" [disabled]="enviando || !nuevaPregunta.trim()">Enviar</button>
    </form>
  </ng-container>
  <ng-template #noAuth>
    <div class="faq-login-message">
      <p>Para comentar o preguntar debes estar registrado e iniciar sesión.</p>
      <div class="faq-login-buttons">
        <a class="btn" routerLink="/register">Registrarse</a>
        <a class="btn" (click)="goToLogin()">Iniciar sesión</a>
      </div>
    </div>
  </ng-template>
  <!-- Preguntas frecuentes institucionales -->
  <app-faq-list></app-faq-list>

  <div class="faq-comentarios">
    <h3>Comentarios y Valoraciones de Clientes</h3>
    <div *ngFor="let c of comentariosOrdenados" class="faq-comentario-item" [class.destacado]="c.destacado">
      <span class="faq-comentario-usuario">{{c.autor}}</span>
      <span class="faq-comentario-fecha">{{c.fecha | date:'short'}}</span>
      <span class="faq-comentario-estrellas" *ngIf="c.estrellas">
        <ng-container *ngFor="let star of [1,2,3,4,5]">
          <span [class.filled]="star <= c.estrellas">★</span>
        </ng-container>
        {{c.estrellas}}/5
      </span>
      <div class="faq-comentario-texto">{{c.pregunta}}</div>
      <div class="faq-comentario-respuesta" *ngIf="c.respuesta">
        <strong>Respuesta:</strong> {{c.respuesta}}
      </div>
    </div>
  </div>
</div>
