<div class="devices-container">
    <div class="devices-header">
        <h1><i class="fas fa-microchip"></i> Gestión de Dispositivos</h1>
        <p>Administra los sensores de calidad del aire</p>
        <button class="btn btn-primary" (click)="nuevoDispositivo()">
            <i class="fas fa-plus"></i>
            Nuevo Dispositivo
        </button>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando dispositivos...</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="error-state">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button class="btn btn-secondary" (click)="cargarDispositivos()">
            <i class="fas fa-sync-alt"></i>
            Reintentar
        </button>
    </div>

    <!-- Devices Grid -->
    <div class="devices-grid" *ngIf="!loading && !error && dispositivos.length > 0">
        <div class="device-card" *ngFor="let dispositivo of dispositivos">
            <div class="device-header">
                <div class="device-icon">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                <div class="device-status">
                    <div class="status-dot" [ngClass]="getStatusClass(dispositivo)"></div>
                    <span>{{ getStatusText(dispositivo) }}</span>
                </div>
            </div>

            <div class="device-info">
                <h3>{{ dispositivo.nombre }}</h3>
                <div class="device-details">
                    <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ dispositivo.ubicacion }}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-network-wired"></i>
                        <span>{{ dispositivo.mac }}</span>
                    </div>
                    <div class="detail-item" *ngIf="dispositivo.usuario">
                        <i class="fas fa-user"></i>
                        <span>{{ dispositivo.usuario.nombre }}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-calendar"></i>
                        <span>{{ formatDate(dispositivo.fechaRegistro) }}</span>
                    </div>
                </div>
            </div>

            <div class="device-actions">
                <button class="btn btn-edit" (click)="editarDispositivo(dispositivo.idDispositivo!)"
                    title="Editar dispositivo">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-delete" (click)="eliminarDispositivo(dispositivo)" title="Eliminar dispositivo">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!loading && !error && dispositivos.length === 0" class="empty-state">
        <i class="fas fa-satellite-dish"></i>
        <h3>No hay dispositivos registrados</h3>
        <p>Crea el primer dispositivo para comenzar a monitorear</p>
        <button class="btn btn-primary" (click)="nuevoDispositivo()">
            <i class="fas fa-plus"></i>
            Crear Dispositivo
        </button>
    </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>Confirmar Eliminación</h3>
        </div>

        <div class="modal-body">
            <p>¿Estás seguro de que deseas eliminar este dispositivo?</p>
            <div class="device-preview" *ngIf="deviceToDelete">
                <div class="device-icon-small">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                <div class="device-info-small">
                    <strong>{{ deviceToDelete.nombre }}</strong>
                    <p>{{ deviceToDelete.ubicacion }}</p>
                </div>
            </div>
            <p class="warning-text">
                <i class="fas fa-info-circle"></i>
                Esta acción eliminará todos los datos asociados al dispositivo.
            </p>
        </div>

        <div class="modal-actions">
            <button class="btn btn-secondary" (click)="closeDeleteModal()">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <button class="btn btn-danger" (click)="confirmDelete()">
                <i class="fas fa-trash-alt"></i>
                Eliminar Dispositivo
            </button>
        </div>
    </div>
</div>