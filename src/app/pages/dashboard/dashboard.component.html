<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Panel Principal</h1>
    <p>Monitoreo en tiempo real de la calidad del aire</p>
  </div>

  <div class="stats-grid" *ngIf="lectura">
    <!-- CO₂ -->
    <div class="stat-card">
      <div class="stat-icon co2"><i class="fas fa-wind"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.co2 }} ppm</h3>
        <p>Dióxido de Carbono (CO₂)</p>
        <span class="status" [ngClass]="getEstado(lectura.co2, 'co2')">{{ getTextoEstado(lectura.co2, 'co2') }}</span>
      </div>
    </div>

    <!-- PM1.0 -->
    <div class="stat-card">
      <div class="stat-icon pm"><i class="fas fa-bacterium"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.pm1_0 }} µg/m³</h3>
        <p>Partículas Finas (PM1.0)</p>
        <span class="status" [ngClass]="getEstado(lectura.pm1_0, 'pm1_0')">{{ getTextoEstado(lectura.pm1_0, 'pm1_0')
          }}</span>
      </div>
    </div>

    <!-- PM2.5 -->
    <div class="stat-card">
      <div class="stat-icon pm"><i class="fas fa-smog"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.pm2_5 }} µg/m³</h3>
        <p>Partículas Finas (PM2.5)</p>
        <span class="status" [ngClass]="getEstado(lectura.pm2_5, 'pm2_5')">{{ getTextoEstado(lectura.pm2_5, 'pm2_5')
          }}</span>
      </div>
    </div>

    <!-- PM10 -->
    <div class="stat-card">
      <div class="stat-icon pm"><i class="fas fa-industry"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.pm10 }} µg/m³</h3>
        <p>Partículas Gruesas (PM10)</p>
        <span class="status" [ngClass]="getEstado(lectura.pm10, 'pm10')">{{ getTextoEstado(lectura.pm10, 'pm10')
          }}</span>
      </div>
    </div>

    <!-- Temperatura -->
    <div class="stat-card">
      <div class="stat-icon temp"><i class="fas fa-thermometer-half"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.temperatura }} °C</h3>
        <p>Temperatura Ambiental</p>
        <span class="status" [ngClass]="getEstado(lectura.temperatura, 'temperatura')">{{
          getTextoEstado(lectura.temperatura, 'temperatura') }}</span>
      </div>
    </div>

    <!-- Humedad -->
    <div class="stat-card">
      <div class="stat-icon humidity"><i class="fas fa-tint"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.humedad }} %</h3>
        <p>Humedad Relativa</p>
        <span class="status" [ngClass]="getEstado(lectura.humedad, 'humedad')">{{ getTextoEstado(lectura.humedad,
          'humedad') }}</span>
      </div>
    </div>

    <!-- Presión -->
    <div class="stat-card">
      <div class="stat-icon pressure"><i class="fas fa-weight"></i></div>
      <div class="stat-info">
        <h3>{{ lectura.presion }} hPa</h3>
        <p>Presión Atmosférica</p>
        <span class="status" [ngClass]="getEstado(lectura.presion, 'presion')">{{ getTextoEstado(lectura.presion,
          'presion') }}</span>
      </div>
    </div>
  </div>


  <div class="main-content">
    <div class="chart-section">
      <h2><i class="fas fa-chart-line"></i> Tendencias (Últimas 24 horas)</h2>
      <canvas #chartCanvas id="lineChart" width="400" height="200"></canvas>
    </div>
  </div>

  <div class="alerts-section">
    <h2><i class="fas fa-exclamation-triangle"></i> Alertas Recientes</h2>

    <div class="alert-item" *ngFor="let alerta of alertas"
      [ngClass]="'alert-nivel-' + obtenerNivelAlerta(alerta).toLowerCase()">
      <div class="alert-icon" [ngClass]="'alert-' + obtenerNivelAlerta(alerta).toLowerCase()">
        {{ obtenerIconoAlerta(alerta.tipoAlerta || 'General') }}
      </div>
      <div class="alert-info">
        <h4>{{ alerta.tipoAlerta }} - {{ obtenerNivelAlerta(alerta) }}</h4>
        <p class="alert-message">{{ generarMensajeAlerta(alerta) }}</p>
        <p class="alert-time">{{ calcularTiempo(alerta.timestamp) }} - {{ obtenerUbicacionAlerta() }}</p>
      </div>
    </div>

    <div *ngIf="alertas.length === 0" class="empty-state">
      <i class="fas fa-shield-check"></i>
      <p>No hay alertas recientes.</p>
    </div>
  </div>

  <div class="devices-section">
    <h2><i class="fas fa-microchip"></i> Dispositivos Activos</h2>

    <div class="device-item" *ngFor="let d of dispositivos">
      <div class="device-info">
        <i class="fas fa-satellite-dish"></i>
        <div>
          <h4>{{ d.nombre }}</h4>
          <p>{{ d.ubicacion }} - MAC: {{ d.mac }}</p>
          <small>{{ getTiempoUltimaLectura(d) }}</small>
        </div>
      </div>
      <div class="device-status">
        <div class="status-dot" [ngClass]="{
          'online': d.estadoConexion === 'online',
          'offline': d.estadoConexion === 'offline',
          'unknown': d.estadoConexion === 'unknown'
        }"></div>
        <span>{{ getTextoEstadoDispositivo(d) }}</span>
      </div>
    </div>

    <div *ngIf="dispositivos.length === 0" class="empty-state">
      <i class="fas fa-satellite-dish"></i>
      <p>No hay dispositivos registrados.</p>
    </div>
  </div>

</div>
